import{r as n}from"./vendor-DMORb-JD.js";import{b as x}from"./main-CPzMFC0N.js";import{P as N}from"./dfinity-TOns67gM.js";import{j as o,m as P}from"./framer-B_r9gDg5.js";const v={Genesis:BigInt(1e8),Evolution:BigInt(5e7),Feature:BigInt(25e6),Quantum:BigInt(75e6)},T=3,h=2e3,k=()=>{const{actor:t,principal:r}=x(),[u,l]=n.useState(!1),[d,f]=n.useState(null),[g,b]=n.useState(null),m=n.useCallback(async()=>{if(!t||!r)throw new Error("Not authenticated");try{return await t.icrc1_balance_of({owner:N.fromText(r),subaccount:[]})}catch(e){throw console.error("Balance check failed:",e),new Error("Failed to fetch balance")}},[t,r]),y=n.useCallback(async({amount:e,memo:a=BigInt(Date.now()),toCanister:c})=>{if(!t||!r)throw new Error("Not authenticated");l(!0),f(null);try{if(await m()<e)throw new Error("Insufficient balance");const i=await t.icrc2_transfer({amount:e,to:{owner:c,subaccount:[]},fee:[],memo:[a],from_subaccount:[],created_at_time:[BigInt(Date.now())]});if("Err"in i)throw new Error(JSON.stringify(i.Err));const w={height:i.Ok,transactionId:i.Ok.toString()};return b(w),w}catch(s){const i=s instanceof Error?s.message:"Payment failed";throw f(i),new Error(i)}finally{l(!1)}},[t,r,m]),E=n.useCallback(async e=>{if(!t)throw new Error("Not authenticated");let a=T;for(;a>0;)try{const c=await t.verify_payment(e);if("Ok"in c)return{verified:!0,timestamp:c.Ok.timestamp,status:"confirmed"};if(a===1)return{verified:!1,timestamp:BigInt(Date.now()),status:"failed"};await new Promise(s=>setTimeout(s,h)),a--}catch{if(a===1)throw new Error("Payment verification failed");await new Promise(s=>setTimeout(s,h)),a--}return{verified:!1,timestamp:BigInt(Date.now()),status:"failed"}},[t]),p=n.useCallback(e=>v[e],[]),I=n.useCallback(async e=>{if(!t)throw new Error("Not authenticated");try{return await t.get_transaction_status(e)}catch(a){throw console.error("Failed to get transaction status:",a),new Error("Transaction status check failed")}},[t]);return{initiatePayment:y,verifyPayment:E,getBalance:m,getPaymentAmount:p,getTransactionStatus:I,isProcessing:u,error:d,lastTransaction:g}},S=({className:t=""})=>{const{balance:r,ledgerService:u,refreshBalance:l}=k();return o.jsx("div",{className:`bg-white/5 rounded-xl p-4 ${t}`,children:o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsx("span",{className:"text-gray-300",children:"Wallet Balance:"}),o.jsxs("div",{className:"flex items-center gap-2",children:[r!==null?o.jsx("span",{className:"text-white font-semibold",children:u?.formatICP(r)}):o.jsx(P.div,{animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},className:"h-6 w-24 bg-white/10 rounded"}),o.jsx("button",{onClick:()=>l(),className:"text-blue-400 hover:text-blue-300 transition-colors",children:"â†»"})]})]})})};export{S as Wallet};
//# sourceMappingURL=Wallet-C-PZYF70.js.map
