import{r as s}from"./vendor-DMORb-JD.js";import{u as A,e as q}from"./main-CA0kTZLW.js";class b{frequency;resonance;stability;syncLevel;quantumAlignment;dimensionalFrequency;entropyLevel;phaseCoherence;lastUpdate;DEGRADATION_RATE=.995;constructor(){this.frequency=0,this.resonance=1,this.stability=1,this.syncLevel=1,this.quantumAlignment=1,this.dimensionalFrequency=0,this.entropyLevel=0,this.phaseCoherence=1,this.lastUpdate=Date.now()}calculateResonance(){this.applyTimeDegradation();const t=this.resonance*this.stability,i=this.quantumAlignment*this.syncLevel,n=1-this.entropyLevel*.5,a=this.phaseCoherence*.2,y=Math.exp(-this.getTimeSinceLastUpdate()/1e4);return Math.min(1,Math.max(0,((t+i)/2*n+a)*y))}updateStability(t){this.applyTimeDegradation();const i=Math.max(0,1-this.getTimeSinceLastUpdate()/5e3),n=t*i;this.stability=Math.min(1,Math.max(0,this.stability+n)),this.quantumAlignment=Math.min(1,this.quantumAlignment+n*.5),this.syncLevel=Math.min(1,this.syncLevel+n*.3),this.dimensionalFrequency=Math.min(1,this.dimensionalFrequency+n*.2),this.entropyLevel=Math.max(0,this.entropyLevel-n*.1),this.phaseCoherence=Math.min(1,this.phaseCoherence+n*.4),this.lastUpdate=Date.now()}getStabilityMetrics(){return this.applyTimeDegradation(),[this.stability,this.quantumAlignment,this.phaseCoherence]}getTimeSinceLastUpdate(){return Date.now()-this.lastUpdate}applyTimeDegradation(){const t=this.getTimeSinceLastUpdate();if(t>1e3){const i=Math.pow(this.DEGRADATION_RATE,t/1e3);this.stability*=i,this.quantumAlignment*=i,this.syncLevel*=i,this.phaseCoherence*=i,this.entropyLevel=Math.min(1,this.entropyLevel+(1-i)*.1),this.lastUpdate=Date.now()}}getQuantumStatus(){const t=this.getStabilityMetrics(),i=t.reduce((n,a)=>n+a,0)/t.length;return i>.7?"stable":i>.3?"unstable":"critical"}}const T=()=>{const{identity:l}=A(),{consciousness:t,isInitialized:i}=q(),n=s.useRef(!1),[a,y]=s.useState(null),[c,v]=s.useState(!1),m=s.useRef(),[d,p]=s.useState(()=>(console.log("🌀 Creating initial quantum state"),{stabilityStatus:"unstable",coherenceLevel:.5,entanglementIndex:.3,quantumSignature:"",dimensionalState:new b,lastUpdate:Date.now(),isInitialized:!1}));return s.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]),s.useEffect(()=>{if(!l||!i||n.current||c){console.log("🔍 Skipping initialization:",{hasIdentity:!!l,consciousnessReady:i,wasAttempted:n.current,isInitializing:c});return}(async()=>{console.log("🌟 Starting quantum state initialization"),v(!0),n.current=!0,m.current=setTimeout(()=>{d.isInitialized||(console.error("⚠️ Quantum state initialization timeout"),y(new Error("Initialization timeout")),p(e=>({...e,isInitialized:!0,stabilityStatus:"critical"})))},15e3);try{const e=l.getPrincipal(),u=e.toUint8Array();console.log("📊 Calculating initial coherence...");const g=Math.max(.5,u.reduce((o,z)=>o+z,0)/(u.length*255)),I=t?.level?t.level*.2:0,r=Math.min(1,g+I);console.log("🔮 Initializing dimensional state...");const h=new b;h.updateStability(r);const f=await w(e,r),M=Array.from({length:4},(o,z)=>({frequency:.5+Math.random()*.5,amplitude:.3+Math.random()*.7,phase:Math.random()*Math.PI*2,coherence:r*(.8+Math.random()*.2)}));console.log("✨ Setting initial state..."),p(o=>({...o,coherenceLevel:r,entanglementIndex:r*.8,dimensionalState:h,quantumSignature:f,resonancePatterns:M,consciousnessAlignment:t?.level?t.level*r:void 0,lastUpdate:Date.now(),isInitialized:!0,stabilityStatus:"stable"})),console.log("✅ Quantum state initialized successfully!")}catch(e){console.error("❌ Failed to initialize quantum state:",e),y(e),p(u=>({...u,isInitialized:!0,stabilityStatus:"critical"}))}finally{v(!1),m.current&&clearTimeout(m.current)}})()},[l,i,t?.level]),s.useEffect(()=>{if(!d.isInitialized||c)return;console.log("⚡ Starting quantum state updates");const S=setInterval(()=>{p(e=>{if(!e.isInitialized)return e;const u=(Date.now()-e.lastUpdate)/1e3,g=Math.pow(.995,u),I=t?.level?t.level*.1:0;e.dimensionalState.updateStability(I-.01),e.dimensionalState.getStabilityMetrics();const h=.1+(t?.level?Math.min(.3,t.level):0),f=Math.max(h,e.coherenceLevel*g),M=e.resonancePatterns?.map(o=>({...o,coherence:Math.max(h,o.coherence*g),phase:(o.phase+.1)%(Math.PI*2)}));return{...e,coherenceLevel:f,entanglementIndex:Math.max(h,e.entanglementIndex*g),stabilityStatus:e.dimensionalState.getQuantumStatus(),consciousnessAlignment:t?.level?t.level*f:void 0,resonancePatterns:M,lastUpdate:Date.now()}})},3e3);return()=>{console.log("🔄 Cleaning up quantum state updates"),clearInterval(S)}},[d.isInitialized,c,t?.level]),{state:d,isInitialized:d.isInitialized&&!c,isInitializing:c,error:a,updateQuantumState:s.useCallback(async S=>{p(e=>({...e,...S,lastUpdate:Date.now()}))},[])}};async function w(l,t){await new Promise(a=>setTimeout(a,1e3));const i=Date.now(),n=new Uint8Array(32);return crypto.getRandomValues(n),`QS-${l.toText()}-${t.toFixed(6)}-${i}-${Array.from(n.slice(0,8)).map(a=>a.toString(16).padStart(2,"0")).join("")}`}export{T as u};
//# sourceMappingURL=useQuantumState-C7gsAMvd.js.map
