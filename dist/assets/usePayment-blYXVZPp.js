import{r as a}from"./vendor-DMORb-JD.js";import{b as p}from"./main-BWusq-dw.js";import{P}from"./dfinity-TOns67gM.js";const T={Genesis:BigInt(1e8),Evolution:BigInt(5e7),Feature:BigInt(25e6),Quantum:BigInt(75e6)},_=3,w=2e3,O=()=>{const{actor:t,principal:o}=p(),[m,u]=a.useState(!1),[h,l]=a.useState(null),[E,g]=a.useState(null),c=a.useCallback(async()=>{if(!t||!o)throw new Error("Not authenticated");try{return await t.icrc1_balance_of({owner:P.fromText(o),subaccount:[]})}catch(e){throw console.error("Balance check failed:",e),new Error("Failed to fetch balance")}},[t,o]),y=a.useCallback(async({amount:e,memo:r=BigInt(Date.now()),toCanister:i})=>{if(!t||!o)throw new Error("Not authenticated");u(!0),l(null);try{if(await c()<e)throw new Error("Insufficient balance");const s=await t.icrc2_transfer({amount:e,to:{owner:i,subaccount:[]},fee:[],memo:[r],from_subaccount:[],created_at_time:[BigInt(Date.now())]});if("Err"in s)throw new Error(JSON.stringify(s.Err));const f={height:s.Ok,transactionId:s.Ok.toString()};return g(f),f}catch(n){const s=n instanceof Error?n.message:"Payment failed";throw l(s),new Error(s)}finally{u(!1)}},[t,o,c]),I=a.useCallback(async e=>{if(!t)throw new Error("Not authenticated");let r=_;for(;r>0;)try{const i=await t.verify_payment(e);if("Ok"in i)return{verified:!0,timestamp:i.Ok.timestamp,status:"confirmed"};if(r===1)return{verified:!1,timestamp:BigInt(Date.now()),status:"failed"};await new Promise(n=>setTimeout(n,w)),r--}catch{if(r===1)throw new Error("Payment verification failed");await new Promise(n=>setTimeout(n,w)),r--}return{verified:!1,timestamp:BigInt(Date.now()),status:"failed"}},[t]),d=a.useCallback(e=>T[e],[]),b=a.useCallback(async e=>{if(!t)throw new Error("Not authenticated");try{return await t.get_transaction_status(e)}catch(r){throw console.error("Failed to get transaction status:",r),new Error("Transaction status check failed")}},[t]);return{initiatePayment:y,verifyPayment:I,getBalance:c,getPaymentAmount:d,getTransactionStatus:b,isProcessing:m,error:h,lastTransaction:E}};export{O as u};
//# sourceMappingURL=usePayment-blYXVZPp.js.map
